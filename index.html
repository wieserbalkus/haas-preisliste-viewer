<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Haas Artikelpreisliste Vertrieb</title>
<meta name="robots" content="noindex, nofollow">
<meta name="googlebot" content="noimageindex">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
  :root{
    --bg:#f7f7f5;
    --card:#ffffff;
    --ink:#111827;
    --muted:#6b7280;
    --row:#fbfbfb;
    --head:#fff6e6;
    --accent:#f59e0b;
    --line:#e6e6e3;
    --drawer-h: 75vh;          /* ge√∂ffneter Drawer: H√∂he */
    --drawer-collapsed: 44px;  /* geschlossener Drawer: Men√ºh√∂he */
    --chrome-offset: 340px;    /* dynamisch per JS √ºberschrieben (Controls + Filter + thead) */
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:2000px;margin:28px auto;padding:0 16px}
  .panel{background:var(--card);border-radius:12px;box-shadow:0 6px 22px rgba(0,0,0,.06);overflow:hidden}

  /* ===== Steuerleiste (ohne obere graue Leiste) =====
     Grid:
       - links: Titel (oben) + Button (darunter)
       - mitte: Logo zentriert (optisch auf einer Linie mit Titel), Container mit fixer H√∂he,
                das Logo selbst ist absolut positioniert -> gr√∂√üer m√∂glich ohne Gesamth√∂he zu erh√∂hen
       - rechts: Dateistatus + Blattwahl
  */
  .controls{
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    align-items:center;
    gap:12px;
    padding:10px 16px;
    border-bottom:1px solid var(--line);
    background:#fff;
  }
  .controls-left{
    display:flex;
    flex-direction:column;       /* Titel √ºber dem Button */
    align-items:flex-start;
    gap:6px;
    min-width:0;
  }
  .version-chip{
    display:flex;
    align-items:center;
    gap:6px;
    font-size:12px;
    color:var(--muted);
  }
  .version-chip .badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:2px 8px;
    border-radius:999px;
    background:var(--ink);
    color:#fff;
    font-weight:600;
    font-size:11px;
    line-height:1;
    letter-spacing:0.015em;
  }
  .controls-center{
    position:relative;
    height:36px;                 /* Fixe Zeilenh√∂he -> Kopf bleibt flach */
    width:220px;                 /* sanfte Begrenzung, optional */
    overflow:visible;
    justify-self:center;
  }
  .controls-right{
    justify-self:end;
    display:flex;flex-direction:column;align-items:flex-end;gap:6px;
  }

  /* Gr√∂√üeres Logo, ohne Schatten/Animation, in der Mitte vertikal ausgerichtet */
  .brand img{
    position:absolute;left:50%;top:50%;
    transform:translate(-50%,-50%);
    height:64px;                 /* << gr√∂√üerer Logo-Wert */
    display:block;
  }
  @media (max-width:700px){ .brand img{height:52px} }

  /* Formelemente in der Steuerleiste */
  .controls select{height:36px;padding:8px 10px;border:1px solid #d1d5db;border-radius:8px}
  .controls button{height:36px;padding:8px 10px;border:1px solid #d1d5db;border-radius:8px}

  /* Flacherer Pill-Button (z.B. Zur√ºcksetzen + manueller Button) */
  .pill{
    background:var(--accent);color:#fff;border:none;cursor:pointer;
    height:32px !important;      /* etwas flacher */
    padding:6px 10px !important;
  }
  .pill:hover{filter:brightness(.95)}

  .muted{color:var(--muted)}
  .current{font-weight:600}
  .inline-title{
    font-size:16px;font-weight:600;line-height:1;margin:2px 0 2px 0;
    white-space:nowrap;
  }

  .statusline{display:block;max-width:520px;text-align:right;font-size:12px;line-height:1.2;color:var(--muted);min-height:1.2em}
  .statusline[data-status="ok"]::before{content:"‚úì ";font-weight:700}
  .statusline[data-status="info"]::before{content:"‚ÑπÔ∏é ";font-weight:700}
  .statusline[data-status="warn"]::before{content:"‚ö†Ô∏é ";font-weight:700}

  /* << NEU: Stil f√ºr den [Anleitung]-Link rechts oben */
  .help-link{
    margin-left:8px;
    font-size:12px;
    text-decoration:underline;
    color: var(--accent);
    white-space:nowrap;
  }
  .help-link:hover{ filter:brightness(.95); }

  @media (max-width:720px){
    .controls{grid-template-columns: 1fr 1fr; grid-template-areas:
      "left right"
      "center center";
    }
    .controls-left{grid-area:left}
    .controls-center{grid-area:center;margin-top:4px}
    .controls-right{grid-area:right;align-items:stretch}
    .statusline{text-align:left}
  }

  /* ===== Filter ===== */
  .filters{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;padding:8px 16px;border-bottom:1px solid var(--line);background:#fffdf6}
  .filters input, .filters select{height:30px;padding:4px 6px;border:1px solid #d1d5db;border-radius:6px}
  .filters .row-wide{grid-column:1/-1}

  /* ===== Tabelle / Scrollverhalten ===== */
  .table-wrap{
    overflow:auto;border-top:1px solid var(--line);
    height: calc(100vh - var(--chrome-offset) - var(--drawer-collapsed));
    max-height: calc(100vh - var(--chrome-offset) - var(--drawer-collapsed));
  }
  body.drawer-open .table-wrap{
    height: calc(100vh - var(--chrome-offset) - var(--drawer-h));
    max-height: calc(100vh - var(--chrome-offset) - var(--drawer-h));
  }

  table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
  thead th{position:sticky;top:0;background:var(--head);z-index:20;text-align:left;font-weight:600;padding:8px;border-bottom:1px solid #d8dee6}
  thead th:first-child{left:0;z-index:21}
  td:first-child{position:sticky;left:0;background:inherit;z-index:10}

  tbody tr.group{background:#fff9ed}
  tbody tr.group td:first-child{z-index:11}
  tbody tr.group{ scroll-margin-top: 52px; }

  tbody td{padding:6px 8px;border-bottom:1px solid #eef0f3;vertical-align:top}
  tbody tr:nth-child(even):not(.group){background:var(--row)}
  .right{text-align:right}
  .empty{padding:24px;text-align:center;color:var(--muted)}
  .desc{white-space:pre-wrap;line-height:1.35em;word-break:break-word;overflow-wrap:anywhere}
  .no-sort{
    cursor:default;
    user-select:text;
  }
  .no-sort::after{display:none !important;content:none !important;}
  .qty{width:70px;text-align:right}
  .qty::placeholder{color:#bbb}

  .qty-wrap{display:flex;align-items:center;gap:6px}
  .addbtn{width:28px;height:28px;border:1px solid #d1d5db;border-radius:6px;background:#fff;cursor:pointer;line-height:1;display:inline-flex;align-items:center;justify-content:center}
  .addbtn:hover{background:#fff9f0;border-color:#f59e0b}
  .addbtn.added{background:#f59e0b;color:#fff;border-color:#f59e0b}
  .addbtn:disabled{opacity:.4;cursor:not-allowed}

  .cell-edit{width:100%;border:1px solid #d1d5db;border-radius:6px;padding:6px 8px;font:inherit;color:inherit;background:#fff}
  .cell-edit.ta{min-height:28px;height:34px;resize:vertical;overflow:hidden;line-height:1.25}
  .cell-edit.price{ text-align:right }
  .cell-edit:focus{outline:2px solid #f59e0b22;border-color:#f59e0b}

  .desc a{ text-decoration:underline; word-break:break-all; }

  /* ===== Bottom Drawer ===== */
  .summary{
    position:fixed;left:0;right:0;bottom:0;margin:0;border-top:1px solid var(--line);
    background:#fff;transform:translateY(calc(100% - var(--drawer-collapsed)));
    transition:transform .18s ease;z-index:1000;padding:0;box-shadow:0 -10px 28px rgba(0,0,0,.12);
  }
  .summary.open{ transform:translateY(0); }
  .drawer-head{display:flex;align-items:center;justify-content:space-between;gap:10px;height:var(--drawer-collapsed);padding:0 10px 0 6px;background:#fffdf6;border-bottom:1px solid var(--line)}
  .drawer-left{display:flex;align-items:center;gap:10px;width:100%}
  .drawer-toggle{display:flex;align-items:center;gap:10px;height:32px;padding:0 12px;border:1px solid #e6e6e3;border-radius:999px;background:#fff;cursor:pointer;font-weight:700}
  .drawer-toggle:hover{background:#fff9f0;border-color:#f59e0b80}
  .icon-btn{display:inline-flex;align-items:center;justify-content:center;width:32px;height:32px;border:1px solid #e6e6e3;border-radius:8px;background:#fff;cursor:pointer}
  .icon-btn:hover{background:#fff9f0;border-color:#f59e0b80}
  .icon{font-style:normal;line-height:1;font-size:16px}
  .drawer-body{height:var(--drawer-h);overflow:auto;padding:10px 16px 14px}
  .summary h3{margin:6px 0 8px 0;font-size:15px}
  .summary table{width:100%;table-layout:auto}
  .summary th,.summary td{padding:6px 8px;border-bottom:1px dashed #eee}
  .summary .tot{font-weight:700}
  .neg{color:#b91c1c;font-weight:600}

  .meta-inputs{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:8px 0 12px}
  .meta-inputs label{font-size:12px;color:var(--muted)}
  .meta-inputs input{height:34px;padding:6px 10px;border:1px solid #d1d5db;border-radius:8px;min-width:220px}

  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(245,158,11,.0)}40%{box-shadow:0 0 0 6px rgba(245,158,11,.25)}100%{box-shadow:0 0 0 0 rgba(245,158,11,.0)}}
  .drawer-head.pulse{animation:pulse .8s ease}

  .sum-delta{transition:filter .3s, color .3s}
  .sum-up::after{content:" ‚ñ≤";font-weight:700}
  .sum-down::after{content:" ‚ñº";font-weight:700}
  .sum-up{color:#166534}
  .sum-down{color:#b91c1c}

  .toast{
    position:fixed;left:14px;bottom:56px;background:#111827;color:#fff;padding:8px 12px;border-radius:10px;font-size:12px;box-shadow:0 6px 18px rgba(0,0,0,.2);
    opacity:0;transform:translateY(6px);pointer-events:none;transition:opacity .18s ease, transform .18s ease;z-index:1100
  }
  .toast.show{opacity:1;transform:translateY(0)}

  .print-portal{display:none}
  .print-footer{display:none;position:fixed;left:0;right:0;bottom:0;padding:4mm 12mm;font-size:10pt;display:flex;justify-conte
nt:space-between;align-items:center;color:#555;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:rgba(255,255,255,.96);}
  .print-footer span{white-space:nowrap}
  .print-footer-right{text-align:right}

  @page {
    size: A4 landscape;
    margin: 12mm;
  }

  @media print{
    body{
      background:#fff;
    }
    header, .controls, .filters, .summary, .toast, .drawer, .drawer-head, .drawer-body, .wrap > .panel > .table-wrap{display:no
ne !important}
    .print-portal{display:block !important}
    body[data-print-mode] .print-footer{display:flex !important}
    body[data-print-mode] .print-page::after{content:counter(page)}
    body[data-print-mode] .print-pages::after{content:counter(pages)}
    body[data-print-mode] .print-portal{padding-bottom:18mm}
    body[data-print-mode] .print-portal table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:10pt}
    body[data-print-mode] .print-portal thead th{background:#fff6e6;-webkit-print-color-adjust:exact;print-color-adjust:exact}
    body[data-print-mode] .print-portal th,body[data-print-mode] .print-portal td{padding:4px 6px;border-bottom:1px solid #d9dd
e4;vertical-align:top}
    body[data-print-mode] .print-portal tr{break-inside:avoid}
    body[data-print-mode] .print-portal .group-row{background:#fff9ed;font-weight:600}
    body[data-print-mode] .print-portal .group-row td{padding-top:6px;padding-bottom:6px}
    body[data-print-mode] .print-portal .desc{white-space:pre-wrap;line-height:1.35em}
  }

  @media (max-width:1200px){
    .data-table .col-ehinfo{display:none}
    .data-table thead th:nth-child(5), .data-table tbody td:nth-child(5){display:none}
  }
  @media (max-width:980px){ thead th,tbody td{padding:6px 6px} td.right,th.right{font-size:13px} }
  @media (max-width:720px){ tbody td{padding:5px 6px} .desc{line-height:1.25} }

  mark.hl{
    background:#fde68a;
    color:inherit;
    padding:0 0.1em;
    border-radius:3px;
    box-shadow:0 0 0 1px #f59e0b66 inset;
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">

    <!-- ===== Steuerleiste (Titel oben, darunter Button; Logo Mitte) ===== -->
    <div class="controls" id="controls">
      <div class="controls-left">
        <span class="inline-title">Haas Artikelpreisliste (Vertrieb)</span>
        <div class="version-chip" id="versionChip" title="">
          <span>Programmversion</span>
          <span class="badge" id="versionBadge">‚Äì</span>
        </div>
        <!-- versteckter Datei-Input: nur Klick per Button -->
        <input id="file" type="file" accept=".xlsx,.xlsm" style="display:none" />
        <button id="reset" class="pill" title="Filter zur√ºcksetzen">Zur√ºcksetzen</button>
      </div>

      <div class="controls-center">
        <div class="brand"><img src="Logo_Haas.jpg" alt="Haas Logo"/></div>
      </div>

      <div class="controls-right">
        <span class="muted">
          Aktuell: <span id="currentFile" class="current">‚Äì keine ‚Äì</span> ¬∑
          <span id="count" class="muted"></span>
          <!-- << NEU: Anleitung-Link √∂ffnet in neuer Registerkarte -->
          <a href="anleitung.html" class="help-link" target="_blank" rel="noopener">[Anleitung]</a>
        </span>
        <select id="sheetSel" title="Blatt"></select>
        <!-- erscheint NUR wenn Autoload fehlschl√§gt -->
        <button id="manualBtn" class="pill" style="display:none" title="Datei manuell ausw√§hlen">Manuell ausw√§hlen‚Ä¶</button>
        <small id="hint" class="statusline" data-status="info"></small>
      </div>
    </div>

    <!-- ===== Filter ===== -->
    <div class="filters" id="filters">
      <select id="groupFilter" class="row-wide" title="Obergruppe"><option value="">Obergruppe (alle)</option></select>
      <input id="fA" placeholder="Filter: Artikelnummer" />
      <input id="fB" placeholder="Filter: Kurztext" />
      <input id="fC" placeholder="Filter: Beschreibung" />
      <input id="search" class="global" placeholder="Globale Suche (alle Spalten)‚Ä¶" />
    </div>

    <!-- ===== Tabelle ===== -->
    <div class="table-wrap" id="tableWrap">
      <table class="data-table">
        <colgroup>
          <col style="width:90px"><col style="width:220px"><col style="width:40%"><col style="width:80px">
          <col class="col-ehinfo" style="width:80px"><col style="width:100px"><col style="width:140px"><col style="width:100px"><col style="width:34%">
        </colgroup>
        <thead id="thead">
          <tr>
            <th>Art.Nr.</th><th>Kurztext</th><th>Beschreibung</th><th>EH</th><th>EH-Info</th>
            <th id="thPreis" class="right no-sort">EH-Preis</th><th>Menge</th><th class="right">Gesamtpreis</th><th>Hinweis</th>
          </tr>
        </thead>
        <tbody id="rows"><tr class="empty"><td colspan="9">Noch keine Daten geladen.</td></tr></tbody>
      </table>
    </div>

    <!-- ===== Bottom Drawer (Zusammenfassung) ===== -->
    <div class="summary" id="summary">
      <div class="drawer-head" id="drawerHead">
        <div class="drawer-left">
          <button id="toggleDrawer" class="drawer-toggle" type="button" title="Zusammenfassung ein-/ausblenden (Alt+O)">
            <span>Zusammenfassung</span><span>‚Ä¢</span><span id="selCount">0</span> Pos.<span>‚Äì</span>
            <span id="selSum" class="sum-delta">‚Ç¨ 0,00</span>
          </button>
        </div>
        <div class="drawer-right">
          <button id="printSummary" class="icon-btn" title="Zusammenfassung drucken"><i class="icon">üñ®Ô∏è</i></button>
        </div>
      </div>

      <div class="drawer-body">
        <h3>Markierte Positionen</h3>

        <!-- Meta (nur Vorschau/Eingabe) -->
        <div class="meta-inputs">
          <div><label for="bvhInput">BVH</label><br><input id="bvhInput" type="text" placeholder="Name des Bauvorhabens" /></div>
          <div><label for="auftragInput">Auftragsnummer</label><br><input id="auftragInput" type="text" placeholder="Auftragsnummer" /></div>
          <div><label for="erstellerInput">Ersteller</label><br><input id="erstellerInput" type="text" placeholder="Name des Erstellers" /></div>
          <div><label for="betreffInput">Betreff</label><br><input id="betreffInput" type="text" placeholder="z. B. Angebot Innenausbau" /></div>
        </div>

        <div id="summaryTableWrap"></div>
      </div>
    </div>

    <div id="toast" class="toast">Aktualisiert</div>
    <div id="printPortal" class="print-portal" aria-hidden="true"></div>
    <div id="printFooter" class="print-footer" aria-hidden="true">
      <span class="print-footer-left">Haas Preisliste ¬∑ <span id="printVersion">‚Äì</span> ¬∑ generiert: <span id="printTimestamp">‚Äì</span></span>
      <span class="print-footer-right">Seite <span class="print-page" data-counter="page"></span> / <span class="print-pages" data-counter="pages"></span></span>
    </div>
  </div>
</div>

  <script defer src="app.js"></script>
</body>
</html>
